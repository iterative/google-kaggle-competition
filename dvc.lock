schema: '2.0'
stages:
  unzip_dataset:
    cmd: python src/stages/unzip_dataset.py
    deps:
    - path: data/baseline_split.zip
      md5: a10dceec1b22b1b3f4bc08e549ddf978
      size: 292752584
    - path: src/stages/unzip_dataset.py
      md5: 13e131dd90084e23ad49eec6031b798b
      size: 1028
    params:
      params.yaml:
        data:
          root: data
          dataset_baseline: images_128
          teacher_data: teacher_data
          train: baseline_split
    outs:
    - path: data/baseline_split
      md5: 22df0db38f0b7cf7486499b69e391c25.dir
      size: 294272494
      nfiles: 9347
  unzip_dataset@Dishes:
    cmd: python src/stages/unzip_dataset.py --teacher Dishes
    deps:
    - path: data/teacher/Dishes.zip
      md5: 183a5e90af220b5336726cf4320230c9
      size: 347542634
    - path: src/stages/unzip_dataset.py
      md5: c6742a1d19d7abc4a28bf1ee152cc38d
      size: 861
    params:
      params.yaml:
        data:
          root: data
          teacher_data: teacher
          train: baseline_split
    outs:
    - path: data/teacher/Dishes
      md5: 48e93e9f405fd2738e9ecb1c08d03bda.dir
      size: 348038100
      nfiles: 13779
  split_dataset:
    cmd: python src/stages/split_dataset.py --params=params.yaml
    deps:
    - path: data/teacher_data
      md5: 4d4a3ccbfe1529f2b46af216cd00eae0.dir
      size: 609937510
      nfiles: 71927
    - path: src/stages/split_dataset.py
      md5: 30fe0e5c5c66fb3bd598f6d5bf61ded5
      size: 2016
    params:
      params.yaml:
        data:
          archive_baseline: archive.zip
          root: data
          dataset_baseline: images_128
          teacher_data: teacher_data
          train_data: teacher_splitted
        split_dataset:
          index_search:
            output_folder: index_search_splitted
            index_search_ratio: 0.3
            seed: 1337
          teacher_models:
            output_folder: teacher_splitted
            seed: 1337
            test_ratio: 0.3
    outs:
    - path: data/index_search_splitted
      md5: 68716079e18cbe2389c7f04a6bb843b3.dir
      size: 68241849
      nfiles: 2700
    - path: data/teacher_splitted
      md5: bf382f58e31b76b7effe32b2e11d843d.dir
      size: 159616668
      nfiles: 6300
  train_teacher_model@Dishes:
    cmd: python src/stages/train.py --teacher Dishes
    deps:
    - path: data/teacher_splitted/Dishes
      md5: 093f82c5da9bc9c4112630ac61c3b24d.dir
      size: 159616668
      nfiles: 6300
    - path: src/stages/train.py
      md5: 9a5414c2c4a90fa037c370eb8823cc08
      size: 5281
    outs:
    - path: models/teacher/Dishes/model.pt
      md5: 3d09a6fc02fd15cfc96d8fd1b2befc84
      size: 54727541
    - path: reports/dvclive_Dishes.json
      md5: 9ad0a907e6ee80fcae0071545a0b9137
      size: 131
    - path: reports/dvclive_Dishes/scalars
      md5: 203f93ffdb13d71df25453e6ef1d824e.dir
      size: 4937
      nfiles: 3
  unzip_dataset@Landmarks:
    cmd: python src/stages/unzip_dataset.py --teacher Landmarks
    deps:
    - path: data/teacher_data/Landmarks.zip
      md5: 350c8ab421310f9717eac242faa3b409
      size: 638370990
    - path: src/stages/unzip_dataset.py
      md5: 4769d26ff7a1910c16fc15a6ef7ebd39
      size: 1011
    outs:
    - path: data/teacher_data/Landmarks
      md5: ed9b37f78567165ee5b8c769abe312f8.dir
      size: 650138566
      nfiles: 9466
  train_teacher_model@Landmarks:
    cmd: python src/stages/train.py --teacher Landmarks
    deps:
    - path: data/teacher_splitted/Landmarks
      md5: c3b295e14949f409d6e249f894a84b9d.dir
      size: 449196704
      nfiles: 6589
    - path: src/stages/train.py
      md5: 295732f3a22c7c452a7b8415fcf134cf
      size: 2556
    outs:
    - path: dvclive_Landmarks.json
      md5: 388768eabe6a9a2de6c5dae43ef1d31f
      size: 128
    - path: dvclive_Landmarks/scalars
      md5: 2c23d854e493e5bfecb8aa7b5ea259f8.dir
      size: 281
      nfiles: 3
  unzip_dataset@MNIST_exp:
    cmd: python src/stages/unzip_dataset.py --teacher MNIST_exp
    deps:
    - path: data/teacher_data/MNIST_exp.zip
      md5: 9e93d35c365afad58547dda9de1d9e20
      size: 31006560
    - path: src/stages/unzip_dataset.py
      md5: 76423c7f1b0dbd58f01344dc9fb95eda
      size: 1006
    outs:
    - path: data/teacher_data/MNIST_exp
      md5: fab796cd12e859f053717904e923682d.dir
      size: 23551113
      nfiles: 42000
  train_teacher_model@MNIST_exp:
    cmd: python src/stages/train.py --teacher MNIST_exp
    deps:
    - path: data/teacher_splitted/MNIST_exp
      md5: 969d28a80afa27ab23c1baff2e3465db.dir
      size: 16480205
      nfiles: 29394
    - path: src/stages/train.py
      md5: e1b20a391c217bcc743e9761f5ae13ba
      size: 2554
    outs:
    - path: dvclive_MNIST_exp.json
      md5: a1aef61345c46df60e4a248128570293
      size: 129
    - path: dvclive_MNIST_exp/scalars
      md5: 67d413471fdb069f7f179288156289a4.dir
      size: 1052
      nfiles: 3
  unzip_dataset@Benchmark:
    cmd: python src/stages/unzip_dataset.py --teacher Benchmark
    deps:
    - path: data/teacher_data/Benchmark.zip
      md5: bab53d2a224acc036298d77255996397
      size: 293155992
    - path: src/stages/unzip_dataset.py
      md5: 76423c7f1b0dbd58f01344dc9fb95eda
      size: 1006
    outs:
    - path: data/teacher_data/Benchmark
      md5: 2d35f1eb05bc40c5bb7ec7e7d12cc44f.dir
      size: 294272494
      nfiles: 9347
  train_teacher_model@Benchmark:
    cmd: python src/stages/train.py --teacher Benchmark
    deps:
    - path: data/teacher_splitted/Benchmark
      md5: cff20f4b24874586b3fd17e51a92c673.dir
      size: 205297725
      nfiles: 6540
    - path: src/stages/train.py
      md5: fd64cc779ba38e4866da3cf72ba4af15
      size: 2685
    outs:
    - path: models/teacher/Benchmark/model.pt
      md5: 3b7a4b05713d620594decc9abeab67df
      size: 54727797
    - path: reports/dvclive_Benchmark.json
      md5: f75e1842b12f428d5e0c51cf0a0e9e40
      size: 127
    - path: reports/dvclive_Benchmark/scalars
      md5: 3ef76cbd30449d29b6266114796486dd.dir
      size: 4925
      nfiles: 3
  visualise@Benchmark:
    cmd: python src/stages/visualise_embeddings.py --params=params.yaml --teacher
      Benchmark
    deps:
    - path: models/teacher/Benchmark/model.pt
      md5: 3b7a4b05713d620594decc9abeab67df
      size: 54727797
    - path: src/stages/visualise_embeddings.py
      md5: b6489093c57c88f2ab68689193b1224a
      size: 2695
    outs:
    - path: reports/plots/Benchmark/embedding.png
      md5: 3d7f6ad712a49e0b390ba59e8ea18dfb
      size: 148814
  visualise@Dishes:
    cmd: python src/stages/visualise_embeddings.py --params=params.yaml --teacher
      Dishes
    deps:
    - path: models/teacher/Dishes/saved_model.pt
      md5: 788b479cb7ff1db0513a6b79bf13e42b
      size: 54928182
    - path: src/stages/visualise_embeddings.py
      md5: 0494ac5cf2037daaa795c9a2a97a97e0
      size: 2669
    outs:
    - path: reports/plots/Dishes/embedding.png
      md5: 56a8c636793f869eccea8f6f04ce066a
      size: 239295
  train_model@Dishes:
    cmd: python src/stages/train.py --teacher Dishes
    deps:
    - path: data/teacher/Dishes
      md5: 48e93e9f405fd2738e9ecb1c08d03bda.dir
      size: 348038100
      nfiles: 13779
    - path: src/stages/train.py
      md5: f9bbdfe55ed13740ec4be7628f9f9f3c
      size: 5511
    - path: src/utils/networks.py
      md5: c790ca40b0a0d8d3bfbeb792b3197e4a
      size: 3566
    outs:
    - path: models/teacher/Dishes/saved_model.pt
      md5: 788b479cb7ff1db0513a6b79bf13e42b
      size: 54928182
    - path: reports/dvclive_Dishes.json
      md5: 032a77c38cf754a69deca96f7f145cf3
      size: 133
    - path: reports/dvclive_Dishes/scalars
      md5: 6191d2ac04011bd23592272ff9c412d5.dir
      size: 3027
      nfiles: 3
  unzip_dataset@baseline_130k_128_split:
    cmd: python src/stages/unzip_dataset.py --dataset baseline_130k_128_split
    deps:
    - path: data/baseline_130k_128_split.zip
      md5: 3b6dc2fae01725faf31fa8feea4916fd
      size: 1458187736
    - path: src/stages/unzip_dataset.py
      md5: 1fab325a497bfa41db02449a7f760e04
      size: 821
    params:
      params.yaml:
        data:
          root: data
          index_file: index.txt
    outs:
    - path: data/baseline_130k_128_split_index.txt
      md5: 763d7bf14c283f0a0800b0980b26728d
      size: 3795661
  train_model@baseline_130k_128_split:
    cmd: python src/stages/train.py --dataset baseline_130k_128_split
    deps:
    - path: data/baseline_130k_128_split_index.txt
      md5: 763d7bf14c283f0a0800b0980b26728d
      size: 3795661
    - path: src/stages/train.py
      md5: b325f32f6a0dde1686a2507d06a49719
      size: 4533
    - path: src/utils/networks.py
      md5: 3a3f845235b6e5211ae01dd17e04e48e
      size: 3626
    params:
      params.yaml:
        datasets:
        - baseline_130k_128_split
        train:
          model_path: models
          model_file: saved_model.pt
          batch_size: 500
          margin: 10
          lr: 0.001
          scheduler_step_size: 14
          epochs: 18
          embedding_size: 64
    outs:
    - path: models/baseline_130k_128_split/saved_model.pt
      md5: 1abfddbd5e77266ef0f111ee848f458e
      size: 78778614
    - path: reports/dvclive_baseline_130k_128_split.json
      md5: cd9e5203f3cd19f7380c066a05436f66
      size: 133
    - path: reports/dvclive_baseline_130k_128_split/scalars
      md5: 7b518dbb8462bfd4170483861e71a51e.dir
      size: 1860
      nfiles: 3
  visualise@baseline_130k_128_split:
    cmd: python src/stages/visualise_embeddings.py --params=params.yaml --dataset
      baseline_130k_128_split
    deps:
    - path: models/baseline_130k_128_split/saved_model.pt
      md5: 1abfddbd5e77266ef0f111ee848f458e
      size: 78778614
    - path: src/stages/visualise_embeddings.py
      md5: 3f2f51c6ecdb6b74a4fa5710a1595ca5
      size: 2637
    params:
      params.yaml:
        reports:
          root: reports
          plots: plots
    outs:
    - path: reports/plots/baseline_130k_128_split/embedding.png
      md5: 395695fb1eb4d262f66ca0681614254d
      size: 212579
